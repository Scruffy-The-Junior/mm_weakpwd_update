#!/bin/bash


###########################################################################
# This is a simple script that reads the email addresses from a file and  #
# performs password change using mm_change_password and pwgen             #
# generated passwords. 					                  #
#     Author: Damir Poljak                                                #
#     damirp@linuxmagic.com                                               #
#     Date: 9/27/2017                                                     #
###########################################################################


echo -ne "Please enter the file that contains email addresses/nfor users you want passwords genarated for: "
 read address_file

if [ ! -f $address_file ]; then
    echo "File not found! Please run ./mm_pwgen.sh and try again!"
    exit
fi


echo "Password was successfully autogenerated for the following users:" > mm_pwgen_report.txt
echo "================================================================" >> mm_pwgen_report.txt
echo "" >> mm_pwgen_report.txt

while read email_address
do
    pwgen -1 > passwd.tmp
    
    while read password
    do 
        (mm_change_password -e $email_address -p $password) 
	#this needs top be tested as I do not think passing argumets like this is allowed
	
	    echo "$email_address" >> mm_pwgen_report.txt
           
	rm passwd.tmp
	
    done < passwd.tmp
    
done < $address_file

echo -e "Passwords have been auto generated;\nthe report has been written in the mm_pwgen_report.txt file."


